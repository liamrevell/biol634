text(0.1,0.8*par()$usr[4],"threshold",srt=90)
## graph the likelihood function for tip #1
## (can change for any node)
tip<-80
par(mar=c(5.1,4.1,2.1,2.1))
plot(fit$liability,log(object$ace[tip,])+logLik(fit),type="s",
bty="n",xlab="liability",ylab="density") # /delta
grid()
abline(v=0,lty="dotted")
## graph the likelihood function for tip #1
## (can change for any node)
tip<-80
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",ylim=c(ll-2,ll)) # /delta
grid()
abline(v=0,lty="dotted")
## graph the likelihood function for tip #1
## (can change for any node)
tip<-80
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-2,max(ll))) # /delta
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
## graph the likelihood function for tip #1
## (can change for any node)
for(i in 1:Ntip(tree)){
tip<-i
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-2,max(ll))) # /delta
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
Sys.sleep(1)
}
tip<-i
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) # /delta
grid()
abline(v=0,lty="dotted")
## graph the likelihood function for tip #1
## (can change for any node)
for(i in 1:Ntip(tree)){
tip<-i
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) # /delta
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
Sys.sleep(0.5)
}
phytools:::marginal_asr
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
hist(y)
hist(est.y[1:Ntip(tree)])
## simulate tree
tree<-phytools::lambdaTree(pbtree(n=100),0)
## simulate tree
tree<-phytools:::lambdaTree(pbtree(n=100),0)
## simulate liabilities
y<-fastBM(tree)
## simulate threshold trait
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
## fit threshold model
fit<-fitThresh(tree,x,levs=200)
## apply ancr to fit$mk_fit object
object<-ancr(fit$mk_fit,tips=TRUE)
## graph the likelihood function for tip #1
## (can change for any node)
for(i in 1:Ntip(tree)){
tip<-i
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) #
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
Sys.sleep(0.5)
}
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
hist(y)
hist(est.y[1:Ntip(tree)])
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
## load phytools
library(phytools)
## simulate tree
tree<-phytools:::lambdaTree(pbtree(n=100),0)
## simulate tree
tree<-pbtree(n=500)
## simulate liabilities
y<-fastBM(tree)
## simulate threshold trait
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
## fit threshold model
fit<-fitThresh(tree,x,levs=100)
## apply ancr to fit$mk_fit object
object<-ancr(fit$mk_fit,tips=TRUE)
## graph the likelihood function for arbitrary tip
## (can change for any node)
tip<-1
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) #
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
text(0.1,
0.8*diff(par()$usr[3:4])+par()$usr[3],"threshold",srt=90)
text(0.1,
0.9*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
## (can change for any node)
tip<-1
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) #
grid()
abline(v=0,lty="dotted")
text(0.1,
0.9*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
## compare histograms of y & estimated y
par(mfrow=c(2,1))
hist(y)
hist(y,breaks=20)
## compare histograms of y & estimated y
par(mfrow=c(2,1))
hist(y,breaks=20,main="histogram of true liabilities")
hist(est.y[1:Ntip(tree)],breaks=20,
main="histogram of estimated liabilities")
## compare histograms of y & estimated y
par(mfrow=c(2,1))
hist(y,breaks=20,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=20,
main="histogram of estimated liabilities",
xlab="estimated liability")
## simulate star-shaped tree
tree<-phytools:::lambdaTree(pbtree(n=100),0)
## simulate liabilities
y<-fastBM(tree)
## simulate threshold trait
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
## fit threshold model
fit<-fitThresh(tree,x,levs=100)
## apply ancr to fit$mk_fit object
object<-ancr(fit$mk_fit,tips=TRUE)
## graph the likelihood function for arbitrary tip
## (can change for any node)
tip<-1
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) #
grid()
abline(v=0,lty="dotted")
text(0.1,
0.9*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
## compare histograms of y & estimated y
par(mfrow=c(2,1))
hist(y,breaks=20,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=20,
main="histogram of estimated liabilities",
xlab="estimated liability")
breaks<-seq(min(y),max(y),length.out=20)
breaks<-seq(min(y),max(y),length.out=20)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
## load phytools
library(phytools)
## simulate tree
tree<-pbtree(n=500)
## simulate liabilities
y<-fastBM(tree)
## simulate threshold trait
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
## fit threshold model
fit<-fitThresh(tree,x,levs=100)
## apply ancr to fit$mk_fit object
object<-ancr(fit$mk_fit,tips=TRUE)
## graph the likelihood function for arbitrary tip
## (can change for any node)
tip<-1
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) #
grid()
abline(v=0,lty="dotted")
text(0.1,
0.9*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(min(y),max(y),length.out=30)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=30)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
fit$mk_fit
breaks<-seq(min(y),max(y),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(min(y),max(y),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
par(mfrow=c(2,1))
breaks<-seq(min(y),max(y),length.out=32)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
breaks
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=30)
breaks
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
breaks
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
abline(v=0,lty="dotted")
text(0.1,
0.9*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
abline(v=0,lty="dotted")
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
par(mfrow=c(2,1))
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
abline(v=0,lty="dotted")
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8,col="blue",lwd=2)
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
abline(v=0,lty="dotted")
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8,col="blue",lwd=2)
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
abline(v=0,lty="dotted",col="blue",lwd=2)
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
abline(v=0,lty="dotted",col="blue",lwd=2)
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
## load phytools
library(phytools)
## simulate tree
tree<-pbtree(n=500)
## simulate liabilities
y<-fastBM(tree)
## simulate threshold trait
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
## fit threshold model
fit<-fitThresh(tree,x,levs=100)
## apply ancr to fit$mk_fit object
object<-ancr(fit$mk_fit,tips=TRUE)
## graph the likelihood function for arbitrary tip
## (can change for any node)
tip<-1
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) #
grid()
abline(v=0,lty="dotted")
text(0.1,
0.9*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
abline(v=0,lty="dotted",col="blue",lwd=2)
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
abline(v=0,lty="dotted",col="blue",lwd=2)
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
## now do the same thing without information about
## the liability (i.e., on a star tree)
## simulate star-shaped tree
tree<-phytools:::lambdaTree(pbtree(n=100),0)
## simulate liabilities
y<-fastBM(tree)
## simulate threshold trait
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
## fit threshold model
fit<-fitThresh(tree,x,levs=100)
## apply ancr to fit$mk_fit object
object<-ancr(fit$mk_fit,tips=TRUE)
## graph the likelihood function for arbitrary tip
## (can change for any node)
tip<-1
par(mar=c(5.1,4.1,2.1,2.1))
ll<-log(object$ace[tip,])+logLik(fit)
plot(fit$liability,ll,type="s",bty="n",
xlab="liability",ylab="density",
ylim=c(max(ll)-3,max(ll))) #
grid()
abline(v=0,lty="dotted")
text(0.1,
0.9*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90)
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
## compare histograms of y & estimated y
par(mfrow=c(2,1))
breaks<-seq(-max(abs(y)),max(abs(y)),length.out=31)
hist(y,breaks=breaks,main="histogram of true liabilities",
xlab="liability")
abline(v=0,lty="dotted",col="blue",lwd=2)
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
hist(est.y[1:Ntip(tree)],breaks=breaks,
main="histogram of estimated liabilities",
xlab="estimated liability")
abline(v=0,lty="dotted",col="blue",lwd=2)
text(0.1,
0.85*diff(par()$usr[3:4])+par()$usr[3],
"threshold",srt=90,cex=0.8)
library(phytools)
data("elapidae.tree")
par(mfrow=c(2,1))
plotTree(elapidae.tree,ftype='i',fsize=0.6)
par(mfrow=c(2,1))
plotTree(elapidae.tree,ftype='i',fsize=0.4,lwd=1)
plotTree(elapidae.tree,ftype='i',fsize=0.4,lwd=1,
mar=c(2.1,4.1,1.1,1.1))
par(mfrow=c(2,1))
plotTree(elapidae.tree,ftype='i',fsize=0.4,lwd=1,
mar=c(2.1,4.1,1.1,1.1))
object<-ltt(elapidae.tree,plot=FALSE)
object
plot(object,mar=c(5.1,4.1,1.1,1.1),bty="n",las=1,log.lineages=FALSE)
plotTree(elapidae.tree,ftype='i',fsize=0.4,lwd=1,
mar=c(2.1,4.1,1.1,1.1))
pp<-get("last_plot.phylo",envir=.PlotPhyloEnv)
plot(object,mar=c(5.1,4.1,1.1,1.1),bty="n",las=1,log.lineages=FALSE,)
plot(object,mar=c(5.1,4.1,1.1,1.1),bty="n",las=1,log.lineages=FALSE,
xlim=pp$x.lim)
plotTree(elapidae.tree,ftype='i',fsize=0.4,lwd=1,
mar=c(2.1,4.1,1.1,1.1))
par(mar=c(5.1,4.1,1.1,1.1))
plot(object,mar=c(5.1,4.1,1.1,1.1),bty="n",las=1,log.lineages=FALSE,
xlim=pp$x.lim)
gewd()
setwd("courses/Israel-2025/hula2025/")
setwd("../../BIOL634-fall2025/biol634/")
