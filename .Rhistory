dev.off()
cordylid_ml
str(cordylid_mcmc)
obj<-print(cordylid_mcmc)
str(obj)
plot(cordylid_ml$ace,obj)
plot(cordylid_ml$ace,obj,bty="n",pch=21,pt.bg="grey",
xlab="ML estimates",ylab="Bayesian estimates")
plot(cordylid_ml$ace,obj,bty="n",pch=21,bg="grey",
xlab="ML estimates",ylab="Bayesian estimates")
plot(cordylid_ml$ace,obj,bty="n",pch=21,bg="grey",
xlab="ML estimates",ylab="Bayesian estimates",
las=1)
grid()
min(cordylid_armoring)
cordylid.tree$Nnode
## let's specify an informative prior
Prior_mean<-c(
1000,
min(cordylid_armoring),
rep(mean(cordylid_armoring),cordylid.tree$Nnode-1))
var(cordylid_armoring)
Prior_var<-c(
1e6,
0.01,
rep(1000,cordylid.tree$Nnode-1))
cordylid_mcmc.informative<-anc.Bayes(cordylid.tree,
cordylid_armoring,ngen=500000,
control=list(pr.mean=Prior_mean,
pr.var=Prior_var))
cordylid_mcmc.informative
obj<-print(cordylid_mcmc.informative)
plot(cordylid_ml$ace,obj,bty="n",pch=21,bg="grey",
xlab="ML estimates",ylab="Bayesian estimates (informative prior)",
las=1)
grid()
cordylid_cmap.bayes<-contMap(cordylid_tree,
cordylid_armoring,anc.states=obj$ace,plot=FALSE)
cordylid_cmap.bayes<-contMap(cordylid.tree,
cordylid_armoring,anc.states=obj$ace,plot=FALSE)
cordylid_cmap.bayes<-contMap(cordylid.tree,
cordylid_armoring,anc.states=obj$ace,plot=FALSE)
cordylid_cmap.bayes<-setMap(cordylid_cmap.bayes,
hcl.colors(n=100))
plot(cordylid_cmap.bayes,fsize=0.8)
cordylid_cmap.bayes<-contMap(cordylid.tree,
cordylid_armoring,anc.states=obj,plot=FALSE)
cordylid_cmap.bayes<-setMap(cordylid_cmap.bayes,
hcl.colors(n=100))
plot(cordylid_cmap.bayes,fsize=0.8)
dev.off()
obj<-print(cordylid_mcmc.informative)
plot(cordylid_ml$ace,obj,bty="n",pch=21,bg="grey",
xlab="ML estimates",ylab="Bayesian estimates (informative prior)",
las=1)
grid()
cordylid_cmap.bayes<-contMap(cordylid.tree,
cordylid_armoring,anc.states=obj,plot=FALSE)
cordylid_cmap.bayes<-setMap(cordylid_cmap.bayes,
hcl.colors(n=100))
plot(cordylid_cmap.bayes,fsize=0.8)
cordylid_cmap.bayes<-contMap(cordylid.tree,
cordylid_armoring,method="user",
anc.states=obj,plot=FALSE)
cordylid_cmap.bayes<-setMap(cordylid_cmap.bayes,
hcl.colors(n=100))
plot(cordylid_cmap.bayes,fsize=0.8)
plot(cordylid_cmap,ftype="off")
par(mfrow=c(1,2))
plot(cordylid_cmap,ftype="off")
plot(cordylid_cmap.bayes,ftype="off",
direction="leftwards")
plot(cordylid_cmap,ftype="off",fsize=0.6)
plot(cordylid_cmap.bayes,ftype="off",
direction="leftwards",fsize=0.6)
dev.off()
plot(cordylid_cmap.bayes,ftype="off",
direction="leftwards",fsize=0.6)
plot(cordylid_cmap.bayes,ftype="off",
direction="rightwards",fsize=0.6)
nodelabels(frame="circle",cex=0.6)
cordylid_node.42<-density(cordylid_mcmc.informative,what=42)
dev.off()
plot(cordylid_node.42)
cordylid_node.42
## load primate data
data(primate.tree)
data(primate.data)
## pull out our character
activity<-setNames(primate.data$Activity_pattern,
rownames(primate.data))
activity
## fit three models: ER, SYM, ARD models
er_primates<-fitMk(primate.tree,activity,
model="ER")
sym_primates<-fitMk(primate.tree,activity,
model="SYM")
ard_primates<-fitMk(primate.tree,activity,
model="ARD")
## traditionally, we would compare these three
## models and choose the "best"
anova(er_primates,
sym_primates,
ard_primates)
## estimate marginal ancestral states under
## "best" (i.e., ER) model
primate_er.marginal<-ancr(er_primates)
primate_er.marginal
## we can plot this
plot(primate_er.marginal)
## we can plot this
plot(primate_er.marginal,
args.plotTree=list(direction="upwards"))
## we can plot this
plot(primate_er.marginal,
args.plotTree=list(direction="upwards"),
args.nodelabels=list(piecol=c("yellow","pink","purple")))
## we can plot this
plot(primate_er.marginal,
args.plotTree=list(direction="upwards"),
args.nodelabels=list(piecol=c("pink","yellow","purple")))
## we can plot this
plot(primate_er.marginal,
args.plotTree=list(direction="upwards"),
args.nodelabels=list(piecol=c("pink","yellow","navy")))
## we can plot this
plot(primate_er.marginal,
args.plotTree=list(direction="upwards"),
args.nodelabels=list(piecol=c("pink","gold","navy")))
## we can plot this
plot(primate_er.marginal,
args.plotTree=list(direction="upwards",type="fan"),
args.nodelabels=list(piecol=c("pink","gold","navy")))
## we can plot this
plot(primate_er.marginal,
args.plotTree=list(direction="upwards"),
args.nodelabels=list(piecol=c("pink","gold","navy")))
## re-calculate our model comparison
anova(er_primates,
sym_primates,
ard_primates)->aov_primates
aov_primates
primate_modelaveraged.marginal<-ancr(aov_primates)
primate_modelaveraged.marginal
plot(primate_modelaveraged.marginal,
args.plotTree=list(direction="upwards"),
args.nodelabels=list(piecol=c("pink","gold","navy")))
library(phytools)
data(sunfish.tree)
tree<-as.phylo(sunfish.tree)
data(sunfish.data)
x<-setNames(sunfish.data$feeding.mode,
rownames(x))
x<-setNames(sunfish.data$feeding.mode,
rownames(sunfish.data))
fit<-fitThresh(tree,x)
str(fit)
fit$mk_fit
args(ancr)
ancr.fitMk
phytools:::ancr.fitMk
object<-ancr(fit$mk_fit,tips=TRUE)
dim(object)
dim(object$ace)
head(object$ace)
plot(object$ace[1,])
plot(object$ace[1,],type="l")
plot(object$ace[2,],type="l")
plot(object$ace[3,],type="l")
plot(object$ace[4,],type="l")
plot(object$ace[5,],type="l")
Ntip(tree)
plot(object$ace[28,],type="l")
plot(object$ace[29,],type="l")
y<-fastBM(tree)
x<-as.factor(sapply(y,function(x) if(x>0) "a" else "b"))
x
fit<-fitThresh(tree,x)
fit$mk_fit
object<-ancr(fit$mk_fit,tips=TRUE)
dim(object$ace)
head(object$ace)
plot(object$ace[29,],type="l")
plot(object$ace[1,],type="l")
plot(object$ace[2,],type="l")
plot(object$ace[3,],type="l")
apply(object$ace,1,which.max)
str(fit)
est.y<-fit$liability[apply(object$ace,1,which.max)]
est.y
plot(y,est.y[1:Ntip(tree)])
abline(-1,0)
args(abline)
abline(0,-1)
plot(y,est.y[1:Ntip(tree)],bty="n",pch=22,bg="grey")
abline(0,-1,lwd=2,col="blue")
library(phytools)
tree<-pbtree(n=100)
y<-fastBM(tree)
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
fit<-fitThresh(tree,x)
fit$mk_fit
object<-ancr(fit$mk_fit,tips=TRUE)
dim(object$ace)
head(object$ace)
plot(object$ace[3,],type="l")
est.y<-fit$liability[apply(object$ace,1,which.max)]
est.y
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey")
abline(0,-1,lwd=2,col="blue")
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey")
abline(0,1,lwd=2,col="blue")
plot(object$ace[1,],type="l")
str(fit)
delta<-fit$liability[2]-fit$liability[1]
delta
plot(fit$liability,object$ace[1,],type="l")
plot(fit$liability,object$ace[1,],type="s")
plot(fit$liability,object$ace[1,]/delta,type="s")
fit<-fitThresh(tree,x,levs=50)
delta<-fit$liability[2]-fit$liability[1]
object<-ancr(fit$mk_fit,tips=TRUE)
dim(object$ace)
plot(fit$liability,object$ace[1,]/delta,type="s")
plot(fit$liability,object$ace[1,]/delta) #,type="s")
abline(h=0)
abline(v=0)
plot(fit$liability,object$ace[1,]/delta,type="s")
abline(v=0)
fit<-fitThresh(tree,x,levs=100)
delta<-fit$liability[2]-fit$liability[1]
object<-ancr(fit$mk_fit,tips=TRUE)
dim(object$ace)
head(object$ace)
plot(fit$liability,object$ace[1,]/delta,type="s")
est.y<-fit$liability[apply(object$ace,1,which.max)]
est.y
abline(v=0)
fit<-fitThresh(tree,x,levs=200)
delta<-fit$liability[2]-fit$liability[1]
object<-ancr(fit$mk_fit,tips=TRUE)
dim(object$ace)
head(object$ace)
abline(v=0,lty="dotted")
plot(fit$liability,object$ace[1,]/delta,type="s")
abline(v=0,lty="dotted")
plot(fit$liability,object$ace[1,]/delta,type="s",
bty="n",xlab="liability",ylab="density")
grid()
par(mfrow=c(5.1,4.1,2.1,2.1))
plot(fit$liability,object$ace[1,]/delta,type="s",
bty="n",xlab="liability",ylab="density")
grid()
par(mar=c(5.1,4.1,2.1,2.1))
plot(fit$liability,object$ace[1,]/delta,type="s",
bty="n",xlab="liability",ylab="density")
grid()
abline(v=0,lty="dotted")
text(0,0.8*par()$usr[4],"threshold",srt=90)
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
plot(fit$liability,object$ace[1,]/delta,type="s",
bty="n",xlab="liability",ylab="density")
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
est.y<-fit$liability[apply(object$ace,1,which.max)]
est.y
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey")
abline(0,1,lwd=2,col="blue")
grid()
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey")
abline(0,1,lwd=2,col="blue",xlab="simulated liability",
"estimated liability")
grid()
abline(0,1,lwd=2,col="blue",xlab="simulated liability",
ylab="estimated liability")
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
## load phytools
library(phytools)
## simulate tree
tree<-pbtree(n=100)
## simulate liabilities
y<-fastBM(tree)
## simulate threshold trait
x<-as.factor(sapply(y,function(x) if(x<0) "a" else "b"))
## fit threshold model
fit<-fitThresh(tree,x,levs=200)
## compute "delta"
## (this is just to get the density from the prob.)
delta<-fit$liability[2]-fit$liability[1]
## apply ancr to fit$mk_fit object
object<-ancr(fit$mk_fit,tips=TRUE)
## graph the likelihood function for tip #1
## (can change for any node)
par(mar=c(5.1,4.1,2.1,2.1))
plot(fit$liability,object$ace[1,]/delta,type="s",
bty="n",xlab="liability",ylab="density")
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
## estimate tip liabilities
est.y<-fit$liability[apply(object$ace,1,
which.max)][1:Ntip(tree)]
## graph compared to generating liabilities
plot(y,est.y[1:Ntip(tree)],bty="n",pch=21,bg="grey",
xlab="simulated liability",
ylab="estimated liability")
abline(0,1,lwd=2,col="blue")
grid()
## graph the likelihood function for tip #1
## (can change for any node)
tip<-1
par(mar=c(5.1,4.1,2.1,2.1))
plot(fit$liability,object$ace[tip,]/delta,type="s",
bty="n",xlab="liability",ylab="density")
grid()
abline(v=0,lty="dotted")
text(0.1,0.8*par()$usr[4],"threshold",srt=90)
## we can start by keeping it simple:
data(primate.tree)
## load phytools
library(phytools)
## we can start by keeping it simple:
data(primate.tree)
data(primate.data)
## look at data
head(primate.data)
## pull out activity pattern.
activity<-setNames(primate.data$Activity_pattern,
rownames(primate.data))
head(activity)
## fit models:
primate_er<-fitMk(primate.tree,activity,
model="ER")
primate_sym<-fitMk(primate.tree,activity,
model="SYM")
primate_ard<-fitMk(primate.tree,activity,
model="ARD")
## look at ARD model (for instance)
primate_ard
plot(primate_ard,width=TRUE,color=TRUE)
plot(primate_ard,width=TRUE,color=TRUE,
xlim=c(-1.5,1))
plot(primate_ard,width=TRUE,color=TRUE,
xlim=c(-2,1))
plot(primate_ard,width=TRUE,color=TRUE,
xlim=c(-2,1),ylim=c(0,1))
plot(primate_ard,width=TRUE,color=TRUE,
xlim=c(-2,1),ylim=c(-1,1))
plot(primate_ard,width=TRUE,color=TRUE,
xlim=c(-2,1),ylim=c(-1,1),spacer=0.1)
## we would normally do model comparison
anova(primate_er,
primate_sym,
primate_ard)
?ancr
## the "best" model is the ER model
primate_er.marginal<-ancr(primate_er)
## plot the result
plot(primate_er.marginal)
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="fan"))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="fan",fsize=0.8))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="fan",fsize=0.6))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="fan",fsize=0.6),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.1,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,type="arc",
args.plotTree=list(fsize=0.6,arc_height=0.1,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,fsize=0.6,
args.plotTree=list(type="arc",arc_height=0.1,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,fsize=0.8,
args.plotTree=list(type="arc",arc_height=0.1,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.1,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.2,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="fan",fsize=0.6,arc_height=0.2,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.2,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.4,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.4,part=0.9),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.4,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.4,part=0.5),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.5,arc_height=0.4,part=0.5),
args.nodelabels=list(piecol=c("purple","orange","black")))
## we would normally do model comparison
anova(primate_er,
primate_sym,
primate_ard)
## let's get model-averaged marginal states
anova(primate_er,
primate_sym,
primate_ard)->primate_aov
primate_aov
primate_model_averaged.marginal<-ancr(primate_aov)
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.5,arc_height=0.4),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.5,arc_height=0.4),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.5,arc_height=0.4,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot the result
plot(primate_er.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.2,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## plot model averaged result
plot(primate_model_averaged.marginal,
args.plotTree=list(type="arc",fsize=0.6,arc_height=0.2,part=1),
args.nodelabels=list(piecol=c("purple","orange","black")))
## let's do joint reconstruction for the same data (to compare)
## we're just going to use the "best-supported" model, the ER model
primate_er.joint<-ancr(primate_er,type="joint")
## let's plot our result
plot(primate_er.joint)
## let's compare our marginal and joint reconstructions
par(mfcol=c(1,2))
## let's compare our marginal and joint reconstructions
par(mfcol=c(1,2))
plot(primate_er.marginal)
plot(primate_er.joint)
## let's do stochastic character mapping!!
?simmap
primate_simmap<-simmap(primate_aov)
primate_simmap
class(primate_simmap)
## plot our trees
plot(primate_simmap)
## plot our trees
par(mfrow=c(10,10))
plot(primate_simmap,lwd=1,ftype="off")
dev.off()
setNames(c("purple","orange","black"),levels(activity))
plot(primate_simmap[[1]],
colors=setNames(c("purple","orange","black"),
levels(activity)),fsize=0.8,ftype="i")
plot(primate_simmap[[1]],
colors=setNames(c("purple","orange","black"),
levels(activity)),fsize=0.7,ftype="i")
plot(primate_simmap[[2]],
colors=setNames(c("purple","orange","black"),
levels(activity)),fsize=0.7,ftype="i")
plot(primate_simmap[[3]],
colors=setNames(c("purple","orange","black"),
levels(activity)),fsize=0.7,ftype="i")
plot(primate_simmap[[4]],
colors=setNames(c("purple","orange","black"),
levels(activity)),fsize=0.7,ftype="i")
## let's get the density of changes of different types
primate_simmap.dd<-density(primate_simmap)
primate_simmap.dd
## let's graph this
dev.off()
plot(primate_simmap.dd)
getwd()
setwd("courses/BIOL634-fall2025")
setwd("biol634/")
list.files("ex/13")
list.files("ex/14")
